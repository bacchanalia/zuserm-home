#!/usr/bin/perl
use strict;
use warnings;

my $katUrl = "kat.cr";
my $defaultSort="field=size&sorder=desc";

my $usage = "Usage: $0 WORD [WORD ..]\n";

sub getKatHtml($$);
sub run(@);

sub main(@){
  while(@_ > 0 and $_[0] =~ /^-/){
    die $usage;
  }
  my $html = getKatHtml "@_", $defaultSort;

}

sub getKatHtml($$){
  my ($query, $sort) = @_;

  my $url = "$katUrl/usearch/$query?$sort";
  my $tmpFile = "/tmp/kickasstorrents-" . int(time*1000);
  run "wget", $url, "-O", $tmpFile;

  my $html = `cat $tmpFile`;
  run "rm", $tmpFile;

  print "="x30 . "\n";

  return $html;
}

sub run(@){
  print "@_\n";
  system @_;
}

&main(@ARGV);
