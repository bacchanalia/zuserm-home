#!/usr/bin/perl
use strict;
use warnings;
use Time::HiRes qw(sleep);

#args are given only if no other args are given on the cmdline
my @defaultArgs = qw(-Z -F);

sub processArgs(@);
sub run(@);

sub main(@){
  my $pid = fork;
  if($pid == 0){
    sleep 0.5;
    exec "keys-to-window", "feh";
  }else{
    my @args = processArgs @_;

    run "/usr/bin/feh", @args;
    run "kill", $pid;
    run "stty", "sane";
  }
}

sub processArgs(@){
  my @args = @_;
  @args = ("-Z", "-F") if @args == 0;
  return @args;
}

sub run(@){
  print "@_\n";
  system @_;
}

&main(@ARGV);
