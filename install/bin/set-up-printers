#!/usr/bin/perl
use strict;
use warnings;
use lib `dirname $0 | tr -d '\n'`;
use ScriptScript;

my $printersDir = getInstallPath "printers";
my $cupsDir = "/etc/cups";
my $ppdDir = "$cupsDir/ppd";

sub main(@) {
    getRoot();

    if(tryrun "test", "-x", "initctl"){
        tryrun "initctl", "start", "cups";
    }elsif(-x "/etc/init.d/cups"){
        tryrun "/etc/init.d/cups", "start";
    }

    run "cp", "$printersDir/printers.conf", $cupsDir;

    run "rm", "-rf", $ppdDir;
    run "cp", "-ar", "$printersDir/ppd/", $ppdDir;

    run "chown", "root.lp", "$cupsDir/printers.conf", $ppdDir;
    shell "chown root.root $ppdDir/*";

    if(tryrun "test", "-x", "initctl"){
        tryrun "initctl", "stop", "cups";
    }elsif(-x "/etc/init.d/cups"){
        tryrun "/etc/init.d/cups", "start";
    }
}

&main(@ARGV);
