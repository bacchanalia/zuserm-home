#!/usr/bin/perl
use strict;
use warnings;
use lib `dirname $0 | tr -d '\n'`;
use ScriptScript;

sub cupsService($);

my $printersDir = getInstallPath "printers";
my $cupsDir = "/etc/cups";
my $ppdDir = "$cupsDir/ppd";

sub main(@) {
    getRoot(@_);

    }

    cupsService 'stop';

    run "cp", "$printersDir/printers.conf", $cupsDir;

    run "rm", "-rf", $ppdDir;
    run "cp", "-ar", "$printersDir/ppd/", $ppdDir;

    run "chown", "root.lp", "$cupsDir/printers.conf", $ppdDir;
    shell "chown root.root $ppdDir/*";

    cupsService 'start';
}

sub cupsService($){
    my $cmd = shift;
    if(tryrun "test", "-x", "initctl"){
        tryrun "initctl", $cmd, "cups";
    }elsif(-x "/etc/init.d/cups"){
        tryrun "/etc/init.d/cups", $cmd;
    }
}

&main(@ARGV);
