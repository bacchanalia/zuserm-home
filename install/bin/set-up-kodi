#!/usr/bin/perl
use strict;
use warnings;
use lib `dirname $0 | tr -d '\n'`;
use ScriptScript;

my $kodiDir = getHome() . "/.kodi";

my $guisettingsFile = "$kodiDir/userdata/guisettings.xml";

my $bgDir = getHome() . "/.cache/backgrounds/fhd";

my $skin = {
  "skin.confluence.UseCustomBackground" => "true",
  "skin.confluence.CustomBackgroundPath" => "$bgDir/ghibli/nausicaa.jpg",
};

sub main(@) {
    getRoot @_;

    editFile $guisettingsFile, sub {
      my $c = shift;
      for my $key(sort keys %$skin){
        my $val = $$skin{$key};
        my $type = $val =~ /^(true|false)$/ ? "bool" : "string";

        my $typeAtt = "type=\"$type\"";
        my $nameAtt = "name=\"$key\"";

        my $prefix = "\\s*<setting\\s*$typeAtt\\s*$nameAtt>";
        my $line = "        <setting $typeAtt $nameAtt>$val</setting>";

        if(not replaceLine $c, $prefix, $line){
          die "could not update skin setting $key = $val\n";
        }
      }
      $c;
    };
}

&main(@ARGV);
